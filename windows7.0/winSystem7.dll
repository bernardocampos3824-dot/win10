@echo off
setlocal enabledelayedexpansion

:: 1. CONFIGURAÇÃO DE CAMINHOS COMPLEXOS
set "ROOT_DIR=C:\Windows 7.0"
set "CORE_DLL=%ROOT_DIR%\hub_system.dll"
set "REG_KEY=HKCU\Software\Win7LegacyHub"

:: 2. VERIFICAÇÃO DE INTEGRIDADE POR ATRIBUTOS
:check_integrity
for %%I in ("%CORE_DLL%") do (
    set "FILE_SIZE=%%~zI"
    set "FILE_ATTR=%%~aI"
)

:: Se a DLL não tiver o tamanho esperado ou o atributo de oculto sumir: ERRO
if not exist "%CORE_DLL%" goto :panic
if "%FILE_SIZE%"=="" goto :panic

:: 3. CONVERSA ENTRE DLL E REGISTRO (O "PULO DO GATO")
reg query "%REG_KEY%" /v "InstallPath" >nul 2>&1
if %errorlevel% neq 0 (
    :: Se não houver a chave no registro, o programa entende que é cópia pirata/corrompida
    goto :panic
)

goto :load_menu

:panic
cls
color 4F
echo ╔════════════════════════════════════════════════════════════════════╗
echo ║  CRITICAL_PROCESS_DIED : SECURITY_VIOLATION                      ║
echo ╠════════════════════════════════════════════════════════════════════╣
echo ║ A DLL em '%ROOT_DIR%' foi violada ou o registro está ausente.      ║
echo ║ O sistema impediu a execução para evitar danos ao Windows 7.       ║
echo ╚════════════════════════════════════════════════════════════════════╝
timeout /t 5 >nul
exit

:load_menu
:: O seu menu maravilhoso em arco-íris entra aqui.